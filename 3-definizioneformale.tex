\section{Definizione formale}
In questa sezione, si offre una descrizione formale del problema mediante l'utilizzo di un modello di Programmazione Lineare Mista Intera (MILP), che verrà poi inserito come input in Gurobi, un risolutore matematico. Un modello si struttura nel seguente modo:
\begin{align*}
	\max_{x\in \mathbb{Z}^n} \quad & c^Tx \\
	\text{s.t.} \quad & Ax \leq b, \\
	& x \geq 0
\end{align*}
ove $\max_{x\in \mathbb{Z}^n} c^Tx$ rappresenta la funzione obiettivo che deve essere massimizzata o minimizzata, mentre le altre due righe rappresentano i vincoli del modello. Questa sezione è suddivisa in tre parti:
\begin{enumerate}
	\item Problema base: viene definito formalmente il minimo necessario per avere un modello base funzionante, senza andare incontro a vincoli aggiuntivi come skill o preferenze del personale.
	\item Problema esteso: vengono aggiunti i vincoli mancanti al problema base, analizzando anche quali elementi potrebbero andare in conflitto con quelli precedenti.
	\item Possibili estensioni. 
\end{enumerate}

\subsection{Problema base}

Si definisce l'insieme $C$ come l'insieme dei cassieri. Al momento, i cassieri si differenziano solo per il monte orario previsto da contratto:
\begin{equation}
	C=FT\cup PT\cup PTW
\end{equation}
Appartenere a categorie differenti equivale soltanto ad avere monte orari differneti: per il momento, tutti i cassieri condividono la stessa paga oraria (non vi sono differenze di anzianità o di livello contrattuale). Un cassiere $c$ può essere quindi definito nel seguente modo:
\begin{equation}
	c(info, variabili)
\end{equation}
ove $info$ rappresenta i dati del cassiere (non utili per la risoluzione, come nome e cognome) e $variabili$ che sono gli effettivi dati utili al problema (monte ore previsto, numero massimo di turni assegnabili giornalieri, skill, etc.).

Durante una giornata, l'obiettivo del caporeparto è quello di coprire il flusso della clientela in maniera adeguata. Rifacendoci al problema del \textit{Set Covering}, all'articolo di Brucker\cite{BRUCKER2011467} e a quello di Gusmeroli e Bettinelli\cite{gusmeroli2024mixedintegerlinearprogramcreate}, si definiscono:
\begin{center}
	$D=\{1,\dots ,m\}$ i giorni della finestra temporale.\\
	$f(d,k)$ il fabbisogno per lo slot $k$ del giorno $d$.\\
	$T(d)$ l'insieme degli slot temporali del giorno $d$.
\end{center}
Nel caso studiato, $m$ vale 7. Gli slot temporali nei problemi di scheduling possono avere durata variabile, dall'intera giornata lavorativa fino a soli 15 minuti: si è deciso di utilizzare uno slot temporale di mezz'ora. La giornata di lavoro inizia alle 08:00 e finisce alle 20:30 (verrà modificato non appena si introdurranno i vincoli per la spazzatrice), è quindi suddivisa in 25 slot temporali. L'orario è continuato ed è identico per tutti e sette i giorni della settimana, dunque vi sarà da definire un totale di 175 fabbisogni, ognuno per il singolo slot $k$ della giornata $d$. Il fabbisogno viene rappresentato mediante l'utilizzo di una matrice, dove i giorni rappresentano le righe e gli slot le colonne.
I turni assegnati ai dipendenti saranno gli insiemi tipici del \textit{Set Covering}. Si specificano ora i turni:
\begin{center}
	$s(day, start, end, dur)\in S$
\end{center}
$S$ rappresenta l'insieme dei turni $s$, i quali sono caratterizzati da:
\begin{itemize}
	\item day: giorno del turno.
	\item start: slot d'inizio del turno.
	\item end: slot di fine del turno. %forse si può togliere
	\item dur: durata del turno espressa in quantitativo di slot.
\end{itemize}
Si definisce anche l'insieme $S(d)\subset S$, ovvero l'insieme dei turni del giorno $d$. Si definisce anche per i turni il valore:
\begin{equation}
	gap(s1, s2)\in \mathbb{N}
\end{equation}
che rappresenta, per ogni coppia di turni $s1$ e $s2$, lo stacco tra i due turni espressa in slot. $gap(s1, s2)$ vale 0 nel caso in cui due turni si sovrapponessero o nel caso in cui $s2$ fosse precedente a $s1$. La durata dei turni varia dalle 3 alle 5 ore, quindi dai 6 ai 10 slot temporali. Gli slot temporali dovranno essere coperti da almeno $f_{d,k}$ turni. Per dire che un turno $s$ copre uno slot $k$ del giorno $d$, si usa:
\begin{equation}
	copre(s,d,k)\in {0,1}
\end{equation}
Per definire se un cassiere lavora o meno un certo turno, si usa una variabile decisionale:
\begin{center}
	$x(c,s)\in \{0,1\}$
\end{center}
la quale varrà 1 nel caso in cui al cassiere $c$ sia assegnato il turno $s$, 0 altrimenti.

Si definisce la variabile:
\begin{align}
	&H_{settimana}(c)=0.5*\sum_{s\in S}dur(s)*x(c,s)\\
	&H_{settimana}(c)\in \mathbb{R}
\end{align}
che rappresenta le ore totali assegnate al cassiere $c$. Si moltiplica per 0.5 in quanto due slot rappresentano un'ora.

Ogni cassiere dovrà lavorare il monte orario previsto fino ad un massimale da stabilire:
\begin{align}
	&H_{settimana}(c)\ge Mh(c)
	&&\forall c\\
	&H_{settimana}(c)\le maxOre(c)
	&&\forall c
\end{align}
$maxOre(c)$ può essere definito differentemente per ogni singolo cassiere oppure essere costante per tutti. Per adesso, viene considerato costante e pari a 48, come descritto nella sezione 1. 

I cassieri part-time sono gli unici ai quali viene assegnato un singolo turno al giorno, mentre ai full-time e ai part-time fine settimana possono essere assegnati due turni giornalieri:
\begin{displayquote}
	\textit{Part time weekend: 16 ore settimanali, con disponibilità limitata ai giorni sabato e domenica.\dots\\
	\dots ma sono previsti due turni giornalieri per i cassieri full-time e part-time fine settimana (solo il sabato e la domenica per loro)\dots Ai cassieri part-time viene assegnato un solo turno giornaliero.\\
	Un dipendente può lavorare fino a 12 ore al giorno, ma è una situazione indesiderata: si tende ad assegnare fino ad un massimo di 8 ore al giorno ad ogni singolo dipendente\dots}
\end{displayquote}
Si esprime il relativo vincolo per il numero di turni giornalieri:
\begin{align}
	&0\le \sum_{S(d)}x(c,s)\le maxTurni(c,d)
	&&\forall d, \forall c\\
	&maxTurni(c,d) =
	\begin{cases}
		2 & \text{se } c\in FT || (c\in PTW \land d\in {sab,dom})\\
		1 & \text{se } c\in PT \\
		0 & \text{altrimenti}
	\end{cases}\notag
\end{align}
Per il numero di ore giornaliere assegnate a un cassiere $c$ si definisce:
\begin{align}
	&H_{giorno}(c,d)=0.5*\sum_{S(d)}x(c,s)dur(s)\\
	&H_{giorno}(c,d)\in {R}
\end{align}
Deve valere:
\begin{equation}
		H_{giorno}(c,d)\le 12 \quad \forall c, \forall d
\end{equation}
in quanto ogni cassiere può lavorare fino ad un massimo di 12 ore.

Per assegnare due turni ad un cassiere nello stesso giorno, bisogna assicurarsi che i due turni non si sovrappongano:
\begin{align}
	&x(c,s1)+x(c,s2)\le 1
	&&\forall s1,s2\in S(d):gap(s1,s2)=0
\end{align}

Si garantisce la copertura di uno slot mediante il seguente vincolo:
\begin{align}
	&\sum_{S(d)}\sum_{c\in C}x(c,s)copre(s,d,k)\ge f(d,k) 
	&&\forall d\in D, \forall k
\end{align}

Si può infine introdurre la funzione obiettivo per questa parte:
\begin{equation}
	f_1=\sum_{c \in C}H_{settimana}(c)
\end{equation}
ovvero la somma totale delle ore lavorate dall'intero roster dei cassieri, che andrà minimizzata come da richiesta.

I cassieri hanno richiesto uno stacco tra due turni giornalieri il più breve possibile. Questo permetterebbe di ridurre al minimo il tempo trascorso sul luogo di lavoro e aumentare la soddisfazione del personale. Il problema si pone solo nel caso in cui il cassiere faccia due turni in un giorno. Si definisce la seguente variabile binaria:
\begin{equation}
	split(c,d) \in \{0,1\}
\end{equation}
che indica se al lavoratore $c$ vengono assegnati due turni lo stesso giorno $d$. Deve valere:
\begin{align}
	&\sum_{s\in S(d)}x(c,s)\le 1+split(c,d)
	&&\forall c\in FT\cup PTW, \forall d\\
	&\sum_{s\in S(d)}x(c,s)\ge 2*split(c,d)
	&&\forall c\in FT\cup PTW, \forall d
\end{align}
In quanto ci siamo assicurati della non sovrapposizione, possiamo definire:
\begin{equation}
	stacco(c,d)\in \mathbb{N}
\end{equation}
una variabile intera che indica lo stacco tra due turni nel giorno $d$ per il cassiere $c$ espresso in numero di slot temporali. Lo stacco sarà determinato da:
\begin{align}
	&stacco(c,d)\le maxGap\cdot split(c,d)\\
	&stacco(c,d)\ge gap(s1,s2)*(x(c,s1)+x(c,s2)-1)
	&&\forall c\in C, \forall d, \forall (s1,s2)\in S(d),s1\neq s2
\end{align}
che andrà minimizzato:
\begin{equation}
	f_2=\sum_{d \in D}\sum_{c \in C} stacco(c,d)
\end{equation}

Si definisce la variabile:
\begin{equation*}
	riposo(c,d)\in {0,1}
\end{equation*}
che vale 1 se e solo se il cassiere $c$ non è stato assegnato a nessun turno il giorno $d$, 0 altrimenti. Utilizzando un m-vincolo, si definisce la variabile prima spiegata:
\begin{align}
	&\sum_{s\in S(d)}x(c,s)\le maxTurni(c,d)(1-riposo(c,d))
	&&\forall c\in FT\cup PT,\forall d\\
	&\sum_{s\in S(d)}x(c,s)\ge 1-maxTurni(c,d)*riposo(c,d)
	&&\forall c\in FT\cup PT,\forall d
\end{align}
Non si studia il problema per i lavoratori part-time fine settimana, in quanto possono essere assegnati il sabato e la domenica.

Durante la settimana, il cassiere deve avere almeno un giorno di riposo e per evitare un sovraccarico di ore giornaliere (avendo per esempio solo 4 giorni lavorativi da 10 ore ciascuno e 3 di riposo) può arrivare ad un massimo di due giorni di riposo settimanali:
\begin{equation}
	1 \le \sum_{d\in D} riposo(c,d)\le 2
\end{equation}

\subsection{Problema esteso}

\paragraph{Straordinari}
Gli straordinari vengono penalizzati in quanto prevedono una retribuzione maggiorata, aumentando notevolemente il costo finale per il punto vendita. Si introduce:
\begin{center}
	$O(c)\in \mathbb{R}$
\end{center}
che rappresenta le ore straordinarie assegnate al cassiere $c$. Questo valore è maggiore o uguale a 0 e si preferirebbe che valesse 0 per tutti i cassieri del roster. Non vale 0 nel caso in cui:
\begin{equation}
	O(c) \ge H_{settimana}(c)- Mh(c) \quad \forall c\label{vincolo:straordinari}
\end{equation}
ovvero quando al cassiere $c$ vengono assegnate più ore di quelle previste dal contratto. La somma di questi valori va minimizzata:
\begin{equation}
	f_3=\sum_{c \in C}O(c)
\end{equation}
Non si fanno distinzioni tra supplementari e straordinari: sono entrambi penalizzati allo stesso modo. Il peso assegnato a questo obiettivo può variare in base al periodo, rendendo più favorevoli gli straordinari in periodi più critici, come quelli festivi.

%DA QUA!
\paragraph{Equità}
I problemi riguardanti l'equità sono:
\begin{itemize}
	\item Carico orario settimanale uguale per tutti i cassieri dello stesso tipo.
	\item Carico orario giornaliero uguale per tutti i cassieri dello stesso tipo, ad esempio scatta una situazione di inequità nel momento in cui un cassiere part-time lavori 6 ore un giorno mentre un altro part-time ne lavora solo 3.
	\item Nel caso dei cassieri full-time e dei part-time, la gestione delle domeniche libere rientra nel principio di equità. 
\end{itemize}
Per il primo punto, si introduce la variabile:
\begin{equation*}
	H(c)\in \mathbb{R}
\end{equation*}
che rappresenta le ore totali assegnate al cassiere $c$. Vale:
\begin{equation}
	H(c)=\sum_{s\in S} 0.5*dur(s)*x(c,s)
\end{equation}
che rappresenta le ore totali assegnate al cassiere $w$. Si definiscono altre due variabili:
\begin{align*}
	& ore(c)^{+},ore(c)^{-}\in \mathbb{R}
\end{align*}
che rappresentano rispettivamente le ore straordinarie oppure quelle mancanti per raggiungere il monte orario previsto da contratto. Vale quindi:
\begin{align}
	&ore(c)^{+}\ge H(c)-Mh(c)\\
	&ore(c)^{-}\ge Mh(c)-H(c)\\
	& ore(c)^{+}\ge 0,\quad ore(c)^{-}\ge 0
	&& \forall c\in C
\end{align}
ove, se le ore assegnate sono di più rispetto a quelle previste, il valore di $ore(c)^{+}$ sarà uguale al surplus orario, mentre varrà il contrario per $ore(c)^{-}$ nel caso in cui venissero assegnate meno ore al cassiere. L'obiettivo è quello di avere uno stesso quantitativo orario per tutti i cassieri dello stesso tipo, quindi si minimizza:
\begin{equation}
	f_4=\sum_{c\in C} \alpha_1 ore(c)^{+} + \beta_1 ore(c)^{-}
\end{equation}
cioè la somma delle deviazioni dal valore previsto da contratto per ogni tipo. Vale $\alpha, \beta \ge 0$ e in base a quale situazione sia preferibile (di eccesso o di difetto) posso decidere se avere $\alpha \ge \beta$ oppure $\alpha < \beta$. Nel caso analizzato si considera $\alpha > \beta$, in quanto una situazione di surplus è sfavorita per scelta del supermercato; inoltre, per come sono definiti i vincoli attualmente, non è prevista una situazione di difetto di ore rispetto al monte ore.

Altro problema da considerare è la durata dei turni. Sono permessi turni dalle 3 fino alle 5 ore, ma una durata eccessiva dei turni non è ben accetta dal personale e potrebbe portare a situazioni di squilibrio, in cui alcuni dipendenti lavorano un solo turno da 5 ore al giorno mentre altri ne lavorano due da 3/4 ore ciascuno. Per questione di praticità, possiamo imporre un'unica preferenza per l'intero personale verso il turno da 4 ore (si potrebbe andare a specificare per ogni dipendente una preferenza specifica). Si introduce:
\begin{equation}
	pen(s) =
	\begin{cases}
		p_3 &\text{se } dur(s)=6\\
		p_{3.5} &\text{se } dur(s)=7\\
		0 &\text{se } dur(s)=8\\
		p_{4.5} &\text{se } dur(s)=9\\
		p_5 &\text{se } dur(s)=10
	\end{cases}
\end{equation}
che indica le penalità relative ai tipi di turni separati per durata. Si minimizza quindi:
\begin{equation}
	f_5=\sum_{s \in S, c\in C}pen(s)x(c,s) 
\end{equation}
Ogni cassiere potrebbe esprimere la sua preferenza singola: si potrebbe risolvere il problema utilizzando la soluzione vista nel punto precedente per il problema del carico delle ore. 

I cassieri full-time e part-time hanno espresso la loro preferenza verso il riposo domenicale. La finestra temporale attuale è:
\begin{equation*}
	D={1,\dots,m}\quad \text{con } m=7
\end{equation*}
La domenica è identificata da $d=7$, nel caso in cui si volesse ampliare la finestra temporale si potrebbe applicare gli stessi vincoli a tutti i $d$ multipli di 7 (se la finestra temporale inizia di lunedì, altrimenti richiede più accorgimenti). Possiamo definire il riposo domenicale come:
\begin{equation*}
	riposoDomenicale(c)\in {0,1}
\end{equation*}
che varrà 1 se il cassiere viene lasciato a riposo di domenica, quindi:
\begin{equation}
	riposoDomenicale(c)\le riposo(c,d) \quad \forall d\in D: 7\mid d
\end{equation}
Infine, massimizziamo:
\begin{equation}
	f_6=\sum_{c\in (FT\cup PT)}riposoDomenicale(c)
\end{equation}

\paragraph{Riposo continuato}
Si introduce una nuova variabile binaria per indicare il riposo continuato per i cassieri full-time:
\begin{equation*}
	riposoContinuato(c,d)\in {0,1}
\end{equation*}
che indica se per due giorni consecutivi il lavoratore è stato a riposo. Per fare valere questa definizione, si specifica:
\begin{align}
	&riposoContinuato(c,d)\le riposo(c,d)\\
	&riposoContinuato(c,d)\le riposo(c,d+1)\\
	&riposoContinuato(c,d)\le riposo(c,d)+riposo(c,d+1)-1
\end{align}
Si vuole massimizzare questa quantità in quanto richiesto dal personale:
\begin{equation}
	f_7=\sum_{c\in (FT\cup PT)}\sum_{d\in D}riposoContinuato(c,d)
\end{equation}
Da controllare, possibile riposo di 4 giorni se si fanno sabato e domenica di riposo. Da aggiungere preferenza per domenica libera e controllare per sabato

%gimme love
\paragraph{Cassa-reparto}
Fino ad adesso, la situazione di sovracopertura dello slot temporale era ammessa e non veniva considerata. Si introduce:
\begin{equation}
	\Delta(d,k)\in \mathbb{N}
\end{equation}
che indica di quanto viene superato il fabbisogno $f(d,k)$. Vale:
\begin{equation}
	\Delta(d,k) \ge \sum_{c \in C}\sum_{s \in S(d)} copre(s,d,k)x(c,s) - f(d,k)  \quad \forall d,k\\
\end{equation}
$\Delta(d,k)$ non può essere minore di 0, in quanto una situazione di difetto di personale non è ammessa (cambiando i vincoli, si potrebbe introdurre anche questa situazione). Si vuole ora minimizzare la situazione di sovracopertura:
\begin{equation}
	f_8=\sum_{d\in D}\sum_{k\in T(d)}\Delta(d,k)
\end{equation}

Un cassiere che può andare in scatolame avrà un peso minore nel conteggio della copertura del fabbisogno, in quanto, se si presentasse una situazione per cui il numero di cassieri presenti in cassa supera quello necessario, può uscire in corsia, riducendo così il lavoro per il personale di reparto e rimanendo comunque disponibile a rientrare in cassa nel momento in cui il flusso della clientela dovesse aumentare. Si definisce la skill:
\begin{equation}
	c(Mh, info, cassareparto)
\end{equation}
I vincoli visti fino ad adesso valgono anche per questo tipo di dipendenti, solo conteranno di meno quando si andrà a considerare il problema della sovracopertura per i motivi appena spiegati:
\begin{align}
	& \Delta(d,k) \ge \sum_{c \in C}\sum_{s \in S(d)} pesoCopertura(c)*copre(s,d,k)x(c,s) - f(d,k)
	&& \forall d,k\\
	& pesoCopertura(c)=\{\rho_1, \rho_2\}
	&& \rho_1 = 1, \rho_2 < 1
\end{align}

\paragraph{Spazzatrice}
La spazzatrice, per via delle sue dimensioni, può solo essere operata prima dell'apertura dell'ipermercato alla clientela. Il compito viene assegnato principalmente a due cassieri appartenenti al personale interno disponibile, poiché la variabilità del personale addetto alle pulizie, dovuta al fatto che l'ipermercato si affida ad un'azienda esterna, rende più affidabile l’impiego di dipendenti interni. Vengono definiti due nuovi slot per giornata (prima 1=08:00 e 25=20:00, ora 1=07:00 e 27=20:00), che possono essere coperti soltanto dal personale formato. Si introduce così una nuova categoria:
\begin{equation}
	c(Mh, info, cassareparto, spazzatrice)
\end{equation}
Si introduce una nuova skill, la quale, se non è presente, non permette la copertura di alcuni slot temporali, in quanto prevede attività diverse da quelle viste fino ad adesso:
\begin{align}
	&\sum_{c\in C:c(spazzatrice)=0}\sum_{s\in S:copre(s,d,k)=1}x(c,s)=0 \quad \forall d\in D, k={1, 2}\\
	&\sum_{c\in C:c(spazzatrice)=1}\sum_{s\in S:copre(s,d,k)=1}x(c,s)\ge f_{d,k} \quad \forall d\in D, k={1, 2}
\end{align}
Per via del vincolo del riposo obbligatorio tra due giornate, questi cassieri non possono venire pianificati in chiusura (ultimo slot) se il giorno dopo iniziano alle 07:00:
\begin{align}
	&x(c,s_1)\le 1-x(c,s_2) \quad \forall s_1,s_2\in S:day(s_1)=d\land copre(s_1,d,27)=1,\\
	&day(s_2)=d+1\land copre(s_2, d+1, 1)=1 \quad \forall d\in (D\setminus {7}) \notag
\end{align}
In quanto la finestra temporale è limitata ad una singola settimana, il problema del controllo del rispetto del vincolo delle 11 ore di riposo tra la domenica e il lunedì può essere spostato dalla definizione del modello al problema dell'assegnamento dei turni, oppure può essere risolto alla radice impedendo l'assegnazione del cassiere addetto alla pulizia con la spazzatrice allo slot della chiusura della domenica:
\begin{equation}
	x(c,s)=0 \quad \forall s\in S: copre(s,7,27)=1, \forall c\in C:c(spazzatrice)=1
\end{equation}

\subsection{Funzione obiettivo}
\begin{align}
    \min \; & 
    \sum_{i=1}^8\lambda_if_i
    && \lambda_i \in \mathbb{R}
\end{align}
I $\lambda_i$ rappresentano i pesi che noi diamo ai vari obiettivi: più $lambda_i$ è elevato, più l'obiettivo relativo incide nella funzione obiettivo generale, ottenendo di fatto più importanza nella ricerca dell'ottimo. 

%\subsection{Possibili estensioni}
%\begin{itemize}
%	\item I dati possono essere ottenuti mediante l'analisi dei dati delle vendite invece di doversi affidare al lavoro manuale del caporeparto.
%	\item La finestra temporale può essere aumentata da una settimana ad un mese per un'eventuale analisi statistica più robusta.
%	\item Il modello può essere riutilizzato in altri reparti del supermercato o tutt'altro settore che richieda la schedulazione del personale.
%	\item Nel caso in cui il carico di lavoro sia distribuito in maniera equa, si può schedulare il personale in gruppi di persone e non a livello di singolo dipendente; si creano così degli orari che possono circolare in maniera costante (esempio, gruppo 1 assegnato alla mattina mentre il gruppo 2 al pomerigio, mentre la settimana successiva vengono invertiti).
%	\item Oltre alle skill, si può introdurre un tasso di produttività, che va ad indicare quanto un dipendente sia produttivo all'interno dell'ipermercato, possibilmente differenziandolo anche in base alla diversa attività che il dipendente riesce a svolgere (un dipendente può essere più produttivo in scatolame rispetto alla cassa, si deve introdurre qualcosa che riesca a definire cosa sia a livello tecnico la produttività, come ad esempio velocità di battitura in cassa).
%	\item Il punto vendita potrebbe iniziare ad operare 24/7, rendendo necessario una modifica ai vincoli legati agli orari.
%	\item Si possono introdurre differenze di retribuzione dovute a: anzianità, diversi livelli contrattuali, diversi contratti (contratti fatta con vecchia gestione), diverse responsabilità (andare a considerare anche il caporeparto come dipendente da schedulare).
%\end{itemize} 